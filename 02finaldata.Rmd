---
title: '02'
author: "Rimjhim Saxena"
date: "2023-02-22"
output: html_document
---

```{r setup, include=FALSE}
rm(list = ls())
library(dplyr)
a = read.csv("~/OneDrive - UCB-O365/01CURRENT/Structural Transformation Climate Change India/Data/04Append/nss_43_51_56_57_63_66.csv")

a = a[,-c(15:17,19,25:36)]
geog = a[,c(20,2:4,6)]
subround = a[,c(20,1,5,19)]

# Not all districts had all surveys done in one sub round
# Therefore there will be variation in temperature within district
# Gotta rethink following data aggregation - Maybe just need to add temperature by subgroup 
round_ag = subround %>% 
  group_by(round,SubRound,State_District_72) %>% 
  summarise(total = n())
```


Aggregate data 
```{r}
b = a %>% 
  group_by(State_District_72,Job_Sector,round) %>% 
  summarise(mpce = mean(mpce,na.rm = T),
            food_month = mean(foodexp_monthly,na.rm = T),
            clothing_annual = mean(clothing_annual,na.rm = T),
            goodservice_month = mean(GoodsServicesExp_monthly,na.rm = T),
            eduhealth_annual = mean(EduHealth_annual,na.rm = T),
            total = n())

c = a %>% 
  group_by(State_District_72,round) %>% 
  summarise(freq= n())


d = merge(b,c,by=c("State_District_72","round"),all.x = T)
d$share = round((d$total/d$freq)*100,2)
d$Exposure = ifelse(d$Job_Sector=="Service","Insular","Exposed")

e = a %>% 
  group_by(State_District_72,round,Exposure) %>% 
  summarise(tot_exposure = n())

f = merge(d,e,by=c("State_District_72","round","Exposure"))

```

adding geog to data

```{r}
g = merge(f,geog,by=c("State_District_72"))
g$newid = paste0(g$State_District_72,g$round,g$Job_Sector)
g = g[!duplicated(g$newid),]
g = g[,-c(18)]
```


Writing data
```{r}
write.csv(f,"~/OneDrive - UCB-O365/01CURRENT/Structural Transformation Climate Change India/Data/06Final/final-data.csv",row.names = F)
write.csv(g,"~/OneDrive - UCB-O365/01CURRENT/Structural Transformation Climate Change India/Data/06Final/final-wgeog.csv",row.names = F)
```

